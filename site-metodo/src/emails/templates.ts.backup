"use client"

import { render } from '@react-email/render';
import WelcomeEmail from './welcome-email';
import SecurityAlertEmail from './security-alert-email';
import NotificationEmail from './notification-email';
import PasswordResetEmail from './password-reset-email';

export interface EmailTemplateProps {
  name?: string;
  email?: string;
  [key: string]: any;
}

export type EmailTemplateType = 'welcome' | 'security-alert' | 'notification' | 'password-reset';

/**
 * Renderiza um template de email usando React Email
 */
export async function renderEmailTemplate(
  templateType: EmailTemplateType, 
  props: EmailTemplateProps
): Promise<string> {
  try {
    switch (templateType) {
      case 'welcome':
        return await render(WelcomeEmail(props));
        
      case 'security-alert':
        return await render(SecurityAlertEmail(props));
        
      case 'notification':
        return await render(NotificationEmail(props));
        
      case 'password-reset':
        return await render(PasswordResetEmail(props));
        
      default:
        throw new Error(`Template ${templateType} n√£o encontrado`);
    }
  } catch (error) {
    console.error(`Erro ao renderizar template ${templateType}:`, error);
    throw new Error(`Falha ao renderizar template: ${error instanceof Error ? error.message : String(error)}`);
  }
}

/**
 * Fun√ß√£o legado mantida para compatibilidade - DEPRECATED
 * @deprecated Use renderEmailTemplate() para novos desenvolvimentos
 */

export function createWelcomeEmailHtml(props: EmailTemplateProps): string {
  console.warn('createWelcomeEmailHtml is deprecated. Use renderEmailTemplate("welcome", props) instead.');
  const { name = 'Usu√°rio', email = 'usuario@exemplo.com', loginUrl = 'https://metodoatuarial.com/login' } = props;
  
  return render(WelcomeEmail({ name, email, loginUrl }));
}

export function createSecurityAlertEmailHtml(props: EmailTemplateProps): string {
  console.warn('createSecurityAlertEmailHtml is deprecated. Use renderEmailTemplate("security-alert", props) instead.');
  return render(SecurityAlertEmail(props));
}

export function createNotificationEmailHtml(props: EmailTemplateProps): string {
  console.warn('createNotificationEmailHtml is deprecated. Use renderEmailTemplate("notification", props) instead.');
  return render(NotificationEmail(props));
}

export function createPasswordResetEmailHtml(props: EmailTemplateProps): string {
  console.warn('createPasswordResetEmailHtml is deprecated. Use renderEmailTemplate("password-reset", props) instead.');
  return render(PasswordResetEmail(props));
}

/**
 * Fun√ß√£o utilit√°ria para obter template por tipo - DEPRECATED
 * @deprecated Use renderEmailTemplate() para novos desenvolvimentos
 */
export function getEmailTemplate(templateType: string, props: EmailTemplateProps): string {
  console.warn('getEmailTemplate is deprecated. Use renderEmailTemplate() instead.');
  
  switch (templateType) {
    case 'welcome':
      return createWelcomeEmailHtml(props);
    case 'security-alert':
      return createSecurityAlertEmailHtml(props);
    case 'notification':
      return createNotificationEmailHtml(props);
    case 'password-reset':
      return createPasswordResetEmailHtml(props);
    default:
      throw new Error(`Template ${templateType} n√£o encontrado`);
  }
}

// Template de Alerta de Seguran√ßa
export function createSecurityAlertEmailHtml(props: EmailTemplateProps): string {
  const { 
    name = 'Usu√°rio', 
    email = 'usuario@exemplo.com',
    alertType = 'login_attempt',
    location = 'Localiza√ß√£o n√£o identificada',
    ipAddress = '192.168.1.1',
    deviceInfo = 'Dispositivo n√£o identificado',
    timestamp = new Date().toLocaleString('pt-BR'),
    actionUrl = 'https://metodoatuarial.com/security'
  } = props;

  const getAlertInfo = () => {
    switch (alertType) {
      case 'login_attempt':
        return { title: 'Tentativa de Login Detectada', priority: 'high' };
      case 'password_change':
        return { title: 'Senha Alterada', priority: 'medium' };
      case 'suspicious_activity':
        return { title: 'Atividade Suspeita Detectada', priority: 'urgent' };
      default:
        return { title: 'Alerta de Seguran√ßa', priority: 'medium' };
    }
  };

  const alertInfo = getAlertInfo();
  const alertColor = alertInfo.priority === 'urgent' ? '#dc3545' : alertInfo.priority === 'high' ? '#fd7e14' : '#ffc107';

  return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${alertInfo.title} - M√©todo Atuarial</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Ubuntu, sans-serif;
            background-color: #f6f9fc;
            line-height: 1.6;
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: #ffffff;
            margin-bottom: 64px;
        }
        .header { 
            padding: 32px 20px; 
            text-align: center; 
            border-bottom: 1px solid #e6ebf1; 
        }
        .logo { 
            max-width: 150px; 
            height: auto; 
        }
        .content { 
            padding: 32px 20px; 
        }
        .alert-banner { 
            background-color: ${alertColor}; 
            color: white; 
            padding: 12px 16px; 
            border-radius: 4px; 
            text-align: center; 
            margin-bottom: 24px; 
        }
        .alert-text { 
            margin: 0; 
            font-weight: 600; 
            font-size: 14px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        .title { 
            color: #1d1c1d; 
            font-size: 24px; 
            font-weight: 600; 
            text-align: center; 
            margin: 0 0 20px; 
        }
        .text { 
            color: #525f7f; 
            font-size: 16px; 
            margin: 0 0 16px; 
        }
        .details-table { 
            background-color: #f8f9fa; 
            border: 1px solid #e9ecef; 
            border-radius: 4px; 
            padding: 20px; 
            margin: 24px 0; 
        }
        .detail-row { 
            margin-bottom: 12px; 
        }
        .detail-label { 
            color: #6c757d; 
            font-weight: 600; 
            font-size: 14px; 
        }
        .detail-value { 
            color: #212529; 
            font-size: 14px; 
        }
        .button-section { 
            text-align: center; 
            margin: 32px 0; 
        }
        .button { 
            display: inline-block; 
            background-color: #dc3545; 
            color: #ffffff; 
            text-decoration: none; 
            padding: 12px 24px; 
            border-radius: 4px; 
            font-weight: 600; 
            font-size: 16px; 
        }
        .tip-section { 
            background-color: #e7f3ff; 
            border: 1px solid #b8daff; 
            border-radius: 4px; 
            padding: 20px; 
            margin: 24px 0; 
        }
        .tip-title { 
            color: #004085; 
            font-weight: 600; 
            margin: 0 0 12px; 
        }
        .tip-text { 
            color: #004085; 
            font-size: 14px; 
            margin: 0; 
        }
        .footer { 
            border-top: 1px solid #e6ebf1; 
            padding: 32px 20px 20px; 
            text-align: center; 
        }
        .footer-text { 
            color: #8898aa; 
            font-size: 12px; 
            margin: 0 0 8px; 
        }
        .link { 
            color: #007ee6; 
            text-decoration: underline; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://metodoatuarial.com/logo.png" alt="M√©todo Atuarial" class="logo">
        </div>
        
        <div class="content">
            <div class="alert-banner">
                <p class="alert-text">üîí ALERTA DE SEGURAN√áA</p>
            </div>
            
            <h1 class="title">${alertInfo.title}</h1>
            
            <p class="text">Ol√° <strong>${name}</strong>,</p>
            
            <p class="text">
                Detectamos atividade em sua conta. Por favor, revise os detalhes abaixo:
            </p>
            
            <div class="details-table">
                <div class="detail-row">
                    <div class="detail-label">Data/Hora:</div>
                    <div class="detail-value">${timestamp}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Localiza√ß√£o:</div>
                    <div class="detail-value">${location}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Endere√ßo IP:</div>
                    <div class="detail-value">${ipAddress}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Dispositivo:</div>
                    <div class="detail-value">${deviceInfo}</div>
                </div>
            </div>
            
            <p class="text">
                <strong>Se foi voc√™:</strong> Nenhuma a√ß√£o √© necess√°ria.
            </p>
            
            <p class="text">
                <strong>Se n√£o foi voc√™:</strong> Altere sua senha imediatamente.
            </p>
            
            <div class="button-section">
                <a href="${actionUrl}" class="button">Revisar Seguran√ßa da Conta</a>
            </div>
            
            <div class="tip-section">
                <p class="tip-title">üí° Dicas de Seguran√ßa:</p>
                <div class="tip-text">
                    ‚Ä¢ Use senhas √∫nicas e complexas<br>
                    ‚Ä¢ Ative a autentica√ß√£o de dois fatores<br>
                    ‚Ä¢ Monitore regularmente a atividade da sua conta
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p class="footer-text">
                Este √© um email autom√°tico de seguran√ßa enviado para ${email}.
            </p>
            
            <p class="footer-text">
                ¬© 2024 M√©todo Atuarial. Todos os direitos reservados.
            </p>
            
            <p class="footer-text">
                <a href="https://metodoatuarial.com/security" class="link">Central de Seguran√ßa</a> | 
                <a href="https://metodoatuarial.com/contact" class="link">Suporte</a>
            </p>
        </div>
    </div>
</body>
</html>`;
}

// Template de Notifica√ß√£o
export function createNotificationEmailHtml(props: EmailTemplateProps): string {
  const { 
    name = 'Usu√°rio',
    email = 'usuario@exemplo.com',
    notificationType = 'info',
    notificationTitle = 'Nova Notifica√ß√£o',
    notificationMessage = 'Voc√™ tem uma nova notifica√ß√£o.',
    priority = 'normal',
    actionUrl = 'https://metodoatuarial.com/notifications',
    actionText = 'Ver Notifica√ß√µes',
    timestamp = new Date().toLocaleString('pt-BR')
  } = props;

  const getNotificationStyle = () => {
    switch (notificationType) {
      case 'success':
        return { icon: '‚úÖ', color: '#28a745', bg: '#d4edda' };
      case 'warning':
        return { icon: '‚ö†Ô∏è', color: '#ffc107', bg: '#fff3cd' };
      case 'error':
        return { icon: '‚ùå', color: '#dc3545', bg: '#f8d7da' };
      default:
        return { icon: '‚ÑπÔ∏è', color: '#007bff', bg: '#cce7ff' };
    }
  };

  const notificationStyle = getNotificationStyle();

  return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${notificationTitle} - M√©todo Atuarial</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Ubuntu, sans-serif;
            background-color: #f6f9fc;
            line-height: 1.6;
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: #ffffff;
            margin-bottom: 64px;
        }
        .header { 
            padding: 32px 20px; 
            text-align: center; 
            border-bottom: 1px solid #e6ebf1; 
        }
        .logo { 
            max-width: 150px; 
            height: auto; 
        }
        .content { 
            padding: 32px 20px; 
        }
        .notification-card { 
            background-color: ${notificationStyle.bg}; 
            border: 2px solid ${notificationStyle.color}; 
            border-radius: 8px; 
            padding: 20px; 
            margin: 0 0 24px; 
            display: flex; 
            align-items: flex-start; 
        }
        .notification-icon { 
            font-size: 32px; 
            margin-right: 15px; 
        }
        .notification-content { 
            flex: 1; 
        }
        .notification-title { 
            color: ${notificationStyle.color}; 
            font-size: 18px; 
            font-weight: 600; 
            margin: 0 0 8px; 
        }
        .notification-text { 
            color: #374151; 
            font-size: 16px; 
            margin: 0 0 8px; 
        }
        .notification-time { 
            color: #6b7280; 
            font-size: 14px; 
            margin: 0; 
        }
        .text { 
            color: #525f7f; 
            font-size: 16px; 
            margin: 0 0 16px; 
        }
        .button-section { 
            text-align: center; 
            margin: 32px 0; 
        }
        .button { 
            display: inline-block; 
            background-color: #007ee6; 
            color: #ffffff; 
            text-decoration: none; 
            padding: 12px 24px; 
            border-radius: 4px; 
            font-weight: 600; 
            font-size: 16px; 
        }
        .tips-section { 
            background-color: #f8f9fa; 
            border: 1px solid #e9ecef; 
            border-radius: 6px; 
            padding: 20px; 
            margin: 24px 0; 
        }
        .tips-title { 
            color: #495057; 
            font-weight: 600; 
            margin: 0 0 12px; 
        }
        .tips-text { 
            color: #6c757d; 
            font-size: 14px; 
            margin: 0; 
        }
        .footer { 
            border-top: 1px solid #e6ebf1; 
            padding: 32px 20px 20px; 
            text-align: center; 
        }
        .footer-text { 
            color: #8898aa; 
            font-size: 12px; 
            margin: 0 0 8px; 
        }
        .link { 
            color: #007ee6; 
            text-decoration: underline; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://metodoatuarial.com/logo.png" alt="M√©todo Atuarial" class="logo">
        </div>
        
        <div class="content">
            <div class="notification-card">
                <div class="notification-icon">${notificationStyle.icon}</div>
                <div class="notification-content">
                    <h2 class="notification-title">${notificationTitle}</h2>
                    <p class="notification-text">${notificationMessage}</p>
                    <p class="notification-time">${timestamp}</p>
                </div>
            </div>
            
            <p class="text">Ol√° <strong>${name}</strong>,</p>
            
            <p class="text">
                Voc√™ recebeu uma nova notifica√ß√£o em sua conta do M√©todo Atuarial.
            </p>
            
            <div class="button-section">
                <a href="${actionUrl}" class="button">${actionText}</a>
            </div>
            
            <div class="tips-section">
                <p class="tips-title">üîî Configura√ß√µes de Notifica√ß√£o</p>
                <p class="tips-text">
                    Voc√™ pode gerenciar suas prefer√™ncias de notifica√ß√£o por email 
                    acessando as configura√ß√µes da sua conta.
                </p>
            </div>
        </div>
        
        <div class="footer">
            <p class="footer-text">
                Esta notifica√ß√£o foi enviada para ${email} em ${timestamp}.
            </p>
            
            <p class="footer-text">
                ¬© 2024 M√©todo Atuarial. Todos os direitos reservados.
            </p>
            
            <p class="footer-text">
                <a href="https://metodoatuarial.com/unsubscribe" class="link">Cancelar Notifica√ß√µes</a> | 
                <a href="https://metodoatuarial.com/contact" class="link">Suporte</a>
            </p>
        </div>
    </div>
</body>
</html>`;
}

// Fun√ß√£o utilit√°ria para obter template por tipo
export function getEmailTemplate(templateType: string, props: EmailTemplateProps): string {
  switch (templateType) {
    case 'welcome':
      return createWelcomeEmailHtml(props);
    case 'security-alert':
      return createSecurityAlertEmailHtml(props);
    case 'notification':
      return createNotificationEmailHtml(props);
    default:
      throw new Error(`Template ${templateType} n√£o encontrado`);
  }
}
